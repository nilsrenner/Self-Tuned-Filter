\documentclass[../main_config.tex]{subfiles}
\begin{document}

\chapter{Weiterführende Theorie}
In der Überprüfung des Biquad-Filters spielte die Phase nur eine untergeordnete Rolle. Im Folgenden wird durch Detektierung der Phase ein selbsteinstellenden Filter zu designen.\par
\medskip
Anfangs wird dabei die Funktionsweise der einzelnen Bausteine des selfe Tuned Filters besprochen. Dabei werden die theoretisch abgeleiteten Eigenschaften der einzelnen Bauteile mittels Simualtion verifiziert und visuell durch Plots unterstützt. Zur Veranschaulichung wird anfangs auch auf den sehr ähnlich funktionierenden Phasenregelkreis (PLL) eingegangen, um später über den Voltage Controlled Filter zueinem gesamtverständnis des Systems zu gelangen.\par
\medskip



\section{Phasenregelkreis}
Bei einen Phasenregelkreis, im englischen auch PLL (Phase Locked Loop) genannt, handelt es sich um eine geschlossene Rückkopplungsschleife. In dieser wird die Phase eines internen Signals wie dem Ausgang eines Voltage-Controlled Oscillators (VCO) an die Phase eines stabielen, externen Referenzsignals angepasst. Sobald die Signale synchon (locked) zu einander verlaufen besitzen internes und Referenzsignal die gleiche Frequenz. Sobald die Frequenz des Referenzsignals verändert wird, versucht die elektronische Schaltung die Synchonisation aufrecht zu erhalten. Das Ausgangssignal des VCO kann dem eingehenden Steuersignal also über einen gewissen Frequenzbereich folgen.\cite{chengCom}\par
\medskip
Der einfache Aufbau eines Phasenregelkreis besteht aus einem Phasen Detektor, einem Loopfilter und einem VCO. Diese werden wie in der folgenden Abbildung dargestellt angeordnet.\par

\begin{figure}[H]
  \centering
  \resizebox{0.8\textwidth}{!}{\input{Aufbau_pll.tex}}
  \caption{Einfacher Aufbau eines Phasenregelkreises \cite{razaviRF}}
  \label{fig:bsb_pll}
\end{figure}

Dabei bestimmt der Phasendetektor die Phasendifferenz zwischen dem Referenzsignal und dem Ausgangssignal des VCOs. Dieses Signal wird im darauffolgenden Loopfilter geglättet, soddass die bei der Phasendetektion enstehenden Hochfrequenzanteile unterdrückt werden. Der Anschließende VCO gibt anhand seiner Eingangsspannung eine Frequenz aus, die proportional zu seiner Eingangsspannung ist. Stimmt diese Ausgangsfrequenz nun mit der Frequenz des Referenzsignals überein ist der PLL locked.\cite{chengCom}\par
\medskip
Im folgenden werden die ersten beiden Bausteine des PLLs genauer betrachtet. Um jedoch den Phasendetektor zu verstehen muss zuerst die Funktionsweise des analogen Multiplizierers erläutert werden.\par



\section{Analoger Multiplizierer}
Der wichtigste Baustein innerhalb des Phasendetekors ist der analoge Multiplizierer. 

Wie der Name schon verrät bildet ein Analogmultiplizierer das Produkt aus zwei anliegenden Signalen nach dem Schema: $x=a \cdot b$. 

\begin{figure}[H]
  \centering
  \resizebox{0.4\textwidth}{!}{\input{bsb_einfacher_mulitplizierer.tex}}
  \caption{Blockschaltbild des analogen Mulitpliziers}
  \label{fig:bsb_einfacher_multi}
\end{figure}

Wie bereits durch das bisherige Studium bekannt ist, können arithmetische Operationen wie Addition, Subtraktion und Integration mittels Operationsverstäkern mit entsprechender Verschaltung durchgeführt werden. Die Multiplikation zweier Signale lässt sich hingegen nicht so einfach über eine einfache analoge Schaltung realisieren. Eine mögliche Lösung dieses Problems ist der Umweg über den natürlichen Logarithmus und die Exponentialfunktion $e^x$. Über diesen Umweg kann die Multiplikation als einfache Addition durchgeführt werden.\par

\begin{equation*}
x=a \cdot b = e^{ln(a \cdot b)} = e^{ln(a) + ln(b)}
\end{equation*}

Dieser Zusammenhang wird durch folgendes Blockschaltbild verdeutlicht:\par

\begin{figure}[H]
  \centering
  \resizebox{0.8\textwidth}{!}{\input{bsb_multi_funktionell.tex}}
  \caption{Funktionelle Realisierung eines Analogmultiplizierers \textbf{Quelle: Wikipedia}}
  \label{fig:bsb_multi_real}
\end{figure}

\medskip
Da der Logarithmus nicht für negative Zahlen definiert ist, können nur pssitive Eingangssignale multipliziert werden. Aus diesem Grund werden Multiplizierer dieses Typs auch Ein-Quadranten-Multiplizierer genannt. In vielen Anwendungen sollen allerdings auch negative Eingangsspannungen zu einem korrekten Ergebins führen. \par
\medskip
Eine Methode um dies zu erreichen ist, dass wenn ein negatives Vorzeichen auftritt, das Vorzeichen am Ein- und Ausgang des Multiplizierers umzukehren. Leider ist diese Methode als Schaltung sehr umständlich umzusetzen und eher langsam, was für höherfrequente Anwendungen unpraktisch ist. Eine weitere Methode besteht darin, zu den Eingangsspannungen konstante Gleichspannungen zu addieren, sodass die tatsächlichen Eingangsspannungen immer im positiven Bereich bleiben. Die Gleichung für die Ausgangsspannung lautet dann

\begin{equation}
  V_{out} = \frac{(V_x+V_{xk})(V_y+V_{yk})}{E}
\end{equation}

wobei
\begin{itemize}
  \item $V_x$ und $V_y$ die Eingangssignale dartellen,
  \item $V_{xk}$ und $V_{yk}$ die konstannten Gleichspannungen sind,
  \item $E$ die Proportionalitätskonstante beschreibt, in der Praxis häufig als 10V angewendet.
\end{itemize}


Die Proportionalitätskonstante $E$ findet sich in den meisten Gleichungen zur Beschreibung des Ausgangs eines Multiplizierer. Sie sorgt dafür, dass das Ausgangssignal innerhalb des gewünschten Spannungsbereich bleibt und auch starke Verstärkungen korrekt im Pegel der Ausgangsspannung zu sehen sind. Das gewünschte Ausgangssignal $\frac{V_xV_y}{E}$ ergibt sich also aus 

\begin{equation}
  \frac{V_xV_y}{E} = V_{out}-V_x \frac{V_{yk}}{E}-V_y \frac{V_{xk}}{E}- \frac{V_{xk}V_{yk}}{E}
\end{equation}


Liegt die Eingangsspannung $V_x$ im Bereich $-E \leqq V_x \leqq +E$ kann keine negative Spannung am Eingang des Multiplizierer anliegen, wenn die konstante Spannung $V_{xk} = E$  gesetzt wird. Gleiches gilt auch für den zweiten Eingang. Bei Anwendung diese Zusammenhangs auf die bekannten Gleichungen ergibt sich für den Ausgang eines Vier-Quadranten-Multiplizierers folgende Gleichung

\begin{equation}
  V_{out} = \frac{V_xV_y}{E} = \frac{(V_x+E)(V_y+E)}{E} - V_x -V_y - E
\end{equation}

Wobei sie sich für die Umsetzung als Blockschaltbild so erweitert

\begin{equation}
  V_{out} = \frac{V_xV_y}{E} = 4 \cdot \frac{\frac{1}{2}(V_x+E) \cdot \frac{1}{2}(V_y+E)}{E} - V_x -V_y - E
\end{equation}


\medskip
\textbf{BSB Seite 359 in Halbleiter Schaltungstechnik }\cite{halbleiter_4Quad}

\medskip
Formel für den Multiplizierer in der Praxis, weiß noch nicht ob ich das brauche, kommt darauf an, ob ich hinterher erklären muss wieso die multiplikation nicht 100\% korrekt funktioniert.
\medskip

In dieser Bachelorarbeit wird ein MPY634 von Texas Instruments verwendet. Die allgemeine Übertragungsfunktion des MPY634 ist im lautet wiefolgt

\begin{equation}
  V_\text{out}
  = A \left[ \frac{(X_1 - X_2)(Y_1 - Y_2)}{SF} - (Z_1 - Z_2) \right],
  \label{eq:datasheet_multi1}
\end{equation}

wobei
\begin{itemize}
  \item $A$ die offene Verstärkung (open-loop gain) des internen Verstärkers darstellt (typisch \SI{85}{\decibel}),
  \item $SF$ der Skalierungsfaktor (scale factor) ist, der ab Werk auf \SI{10}{V} lasergetrimmt ist, aber durch Anschluss eines Potentiometers zwischen Pin \emph{SF} und $-V_\mathrm{S}$ im Bereich von \SI{3}{V} bis \SI{10}{V} einstellbar bleibt,
  \item $X$, $Y$ und $Z$ jeweils differenzielle Eingangsspannungen sind.
\end{itemize}

Die maximale Eingangsspannung sollte das 1,25-fache des eingestellten Skalierungsfaktors nicht überschreiten.

\medskip
Um eine stabile, geschlossene Übertragungsfunktion zu erhalten, ist eine
negative Rückkopplung erforderlich. Ohne diese würde die große Verstärkung $A$ schon bei kleinsten Abweichungen innerhalb der Klammer den Ausgang bis zum Maximalwert treiben. Wird nun $Z_1$ mit $V_{out}$ verbunden und $Z_2$ auf Masse gelegt, so ergibt sich durch Einsetzen in \eqref{eq:datasheet_multi1} die Näherung

\begin{equation*}
  \frac{(X_1 - X_2)(Y_1 - Y_2)}{SF} - (V_\text{out} - 0) \approx 0.
\end{equation*}

Daraus folgt die geschlossene Übertragungsfunktion

\begin{equation}
  V_\text{out} =
  \frac{(X_1 - X_2)(Y_1 - Y_2)}{SF}.
  \label{eq:datasheet_multi2}
\end{equation}


\medskip 
Da in der Analyse im ASLK manual immer von der Spannung $V_r$ geredet wird, wird im Folgenden nur noch $V_r$ anstatt $SF$ verwendet. Beide beschreiben das Selbe und sind somit werksseitig auf 10V eingestellt, können aber extern verändert werden.


\subsection{Simulation}
Um ein besseres Verständnis für den Multiplizerer zu gewinnen, wird dieser in KiCad mit Spice simuliert.Als erster Test für den Multiplizierer werden als Input-Quellen zwei Gleichspannungen verwendet. Diese werden mit den Pins $X_1$ und $Y_1$ verbunden. Für die spätere Funktion des Phasendetektors werden die Pins $X_2$ und $Y_2$ an Ground angeschlossen. In KiCad können die Simulationsdaten in eine .raw-Datei exportiert werden, die es möglich macht die Ergebnisse in Python zu plotten.\par

\begin{figure} [H]
    \centering
    \includegraphics[width=0.8\linewidth]{../Bilder/dc_multi.png}
    \caption{Multiplikation von DC-Spannungen}
    \label{fig:mult_dc}
\end{figure}
\medskip

Die Grafik \ref{fig:mult_dc} zeigt, dass die oben beschriebene Gleichung \ref{eq:datasheet_multi2} mit der Simulation übereinstimmt. Es können zudem nicht nur positive, sondern auch negative Spannungen korrekt multipliziert werden.




\section{Multiplizierer als Phasendetektor}
Nach der Analyse des analogen Multiplizierer kann nun der erste Baustein des PLLs untersucht werden. Der Phasendetektor baut auf einem Multiplizierer auf, der die Phasendifferenz zwischen zwei Signalen detektieren soll.\par

\begin{figure}[H]  \centering
  \resizebox{0.6\textwidth}{!}{\input{bsb_produkt.tex}}
  \caption{Multiplizierer...}
  \label{fig:bsb_multi}
\end{figure}

In Abbildung \ref{fig:bsb_multi} ist zu erkennen, wie zwei um den Phasenwinkel $\phi$ versetzte Signale auf die Eingänge des Multiplizierers gelegt werden. Dadurch lässt sich der Ausgang des Multiplizierers $V_o$ durch folgende Gleichung beschreiben

\begin{equation*}
V_o = \frac{X Y}{2 V_r} \cdot [cos(\phi)-cos(2\omega t + \phi)]
\end{equation*}

wobei
\begin{itemize}
  \item $X$ und $Y$ die Amplituden der Eingangssignale sind,
  \item $V_r$ der Referenzwert des Multiplizierers ist (laut Datenblatt: $V_r=10V$),
  \item $\phi$ die Phasendifferenz zwischen den beiden Eingangssignalen beschreibt.
\end{itemize}


\textbf{Hinweis:} Im ASLK Manual steht hier $V_o = \frac{X Y}{2 V_r} \cdot [cos(\phi)-cos(\omega t + \phi)]$ was nicht korrekt ist.\par
\medskip

Die  Multiplikation zweier sinusförmiger Signale ergibt demnach ein Signal mit zwei Frequenzkomponenten. Eine Frequenz ist hierbei eine Gleichspannungskomponente $cos(\phi)$, die sich proportional zur Phasendifferenz verhält. Zusätzlich gibt es noch eine hochfrequente Mischkomponente, die mit der doppelten Frequenz des Eingangssignals schwingt. Wenn der Multiplizierer nicht komplett linaren Bereich opperiert werden zudem noch weitere Hochfrequenzkomponenten als vielfaches der Ausgangsfrequenz generiert. \cite{chengCom}%Buch der Chinesen: auch höhere Frequenzen (höherer Faktor der frequenz) könnenn entstehen

Der zweite Block innerhalb des PLLs ist der Loopfilter. Dieser hat die Aufgabe, diese hochfrequenten Anteile der Multiplikation zu unterdrücken. So kann für den Loopfilter ein einfacher RC-Tiefpass verwendet werden. Nach der idealen Tiefpass-Filterung des Ausgangssignals reduziert sich der Ausdruck auf\par

\begin{equation}
V_o = \frac{X Y}{2 V_r} \cdot cos(\phi)
\label{eq:Multi_vereinfacht}
\end{equation}

Diese Gleichung zeigt die direkte Abhänigkeit von Ausgangsspannung des Multiplizierers und der Phasendifferenz der beiden Eingangssignale. Durch diese Verschaltung wird aus dem Multiplizierer ein Phasendetektor, der bei einer Phasendifferenz von $90^\circ$ eine Durchschnittsspannung von $0V$ ausgibt. %Diese Abhänigkeit kann im Folgenden dazu verwendet werden die Ausgangsspannung als Steuerspannung für den Spannungsgesteuerten Filter (VCF) zu verwenden.
Die Abbildung \ref{fig:av_volt_phase} veranschaulicht die Phasencharakteristik des Multiplizierers.\par
\medskip


\begin{figure} [H]
    \centering
    \includegraphics[width=0.8\linewidth]{../Bilder/phasencharakteristik_multi.png}
    \caption{Duchschnittliche Ausgangsspannung des Multiplizierers gegen den Phasenwinkel \cite{YT_stf_lecture23}}
    \label{fig:av_volt_phase}
\end{figure}
\medskip
\textbf{kann es sein das die y achse von den werten her falsch beschriftet ist? das maximum dieser kennlinie sollte doch von $\frac{max_x \cdot max_y}{V_r}$ abhängen.}

Damit bleibt das Problem, dass der Detektor nur eine Phasendifferenz von genau $90^\circ$ erkennen kann. Liegt eine andere konstante Phasenverschiebung zwischen den Signalen an, kann diese zwar detektiert werden, aber nur, ob die Phasendifferenz höher oder niedriger ist als $90^\circ$. Die allgemeine Phasenverschiebung zwischen dem Referenzsignal (Eingangssignal) und internem Signal muss also zwangsläufig $90^\circ$ betragen. Dafür wird nun innerhalb des Voltage Controlled Filters (Biquad, VCF schon eingeführt?) nach einem solchen Signal gesucht.\par
\medskip

Gesucht wird also ein Signal innerhalb des Biquads, dessen Phase sich bei der Mittenfrequenz $\omega=\omega_0$ um \SI{90}{\degree} gegenüber dem Eingangssignal unterscheidet. In Frage kommen daher sowohl eine Phasenverschiebung von \SI{90}{\degree} als auch von \SI{-90}{\degree}. Da es um die Phasendifferenz zwischen dem Eingangssignal und einem internen Signal geht, kann \SI{-90}{\degree} auch als \SI{270}{\degree} interpretiert werden. Das Eingangssignal dient dabei als Bezugssignal und definiert die Referenzphase von \SI{0}{\degree}.\par
\medskip

\begin{figure} [H]
    \centering
    \includegraphics[width=0.8\linewidth]{../Bilder/phasengang_biquad_sem6.png}
    \caption{Phasengänge der vier Ausgänge des Biquads}
    \label{fig:phaseshift}
\end{figure}
\medskip

Der Biquad besitzt vier unterschiedliche Filtertypen, deren Phasengänge sich deutlich von einander Unterscheiden. Bei genauerer Betrachtung der Phasenverläufe in Abbildung \ref{fig:phaseshift} der Filtertypen fällt auf, dass Hoch- und Tiefpass um $\omega_0$ eine Phasenverschiebung von $90^\circ$ bzw. $-90^\circ$ gegenüber dem Eingangssignal aufweisen. Der Bandpassfilter hat in dieser Umgenbung eine Phasenverschiebung von $\pm180^\circ$ und die Bandsperre hat bei $\omega_0$ einen Phasensprung.  Damit erfüllt sowohl der Tiefpass- als auch der Hochpassausgang die Bedingung einer konstanten $90^\circ$-Phasendifferenz, sodass in beiden Fällen der Phasendetektor bei richtiger Abstimmung einen Mittelwert von $0V$ am Ausgang liefern sollte.
\medskip

\begin{figure}[H]
  \centering
  \resizebox{0.8\textwidth}{!}{\input{sb_phasendetektor.tex}}
  \caption{Teilschaltung: Phasendetektor}
  \label{fig:sb_phasedetector}
\end{figure}

\textbf{Hier die sache mit VCO/VCF! im schaubild war ein VCO zusehen. wir haben allerdings einen VCF. wie kann dies miteinander verknüpft werden?}
Hinter dem Multiplizierer befindet sich ein Integrator. Dieser soll die verbleibende hochfrequente Sinuskomponente herausfiltern, sodass eine reine DC-Spannung als Indikator für die Phasendifferenz verbleibt. Dadurch kann diese Ausgangsspannung als DC-Steuerspannung $V_c$ für die internen Multiplikatoren im VCF verwendet werden.\par
\medskip

Im Schaltplan des ASLK-PRO Manuals unter Experiment 5 befindet sich am Ausgang des Integrators noch eine zusätzliche Hilfsspannungsquelle $V_H$. Diese hat die Aufgabe, die Steuerspannung auf ein geeignetes Potential anzuheben. \textbf{Die Bedeutung dieser wird genauer im Kapitel des VCFs untersucht, ein wichtiger Bestandteil hierbei ist die Vereinfachte Darstellung des Multiplizierers wie in Gleichung \ref{eq:Multi_vereinfacht} gezeigt.}

\medskip
\textbf{vielleicht sollte darauf doch besser hier eingengangen werden!}

\subsection{$V_H$}
entweder zur stromverstärkung
oder um das den signalfluss bei korrekter Phasendifferenz gleich aufrecht zu erhalten. 




\subsection{Simulation}
Im folgenden Abschnitt werden die zuvor beschriebenen Zusammenhänge durch eine Simulation überprüft. Hierfür werden dem System Wechselspannungen unterschiedlicher Phasenlage zugeführt.\par
\medskip

Am Eingang $Y_1$ liegt immer ein Sinussignal an. Am Eingang $X_1$ wird das gleiche Signal mit einer veränderten Phase eingespeißt. Im ersten Fall bleibt die Phase unverändert ($\phi = \SI{0}{\degree}$), im zweiten Fall wird sie um \SI{90}{\degree} und im dritten Fall um \SI{180}{\degree} verschoben. Da der Arbeitsbereich der Schaltung bei einem Phasenversatz von \SI{90}{\degree} liegt und das Sinussignal periodisch ist, stellen Verschiebungen um \SI{0}{\degree} und \SI{180}{\degree} die maximal möglichen Abweichungen der Phase dar, während bei $\phi = \SI{90}{\degree}$ der Idealwert erreicht wird. Die real auftretenden Werte sollten daher zwischen oder auf diesen Extrempunkten liegen.\par
\medskip

Im linken Teil der Abbildung \ref{fig:ac_multi_pd} sind die drei untersuchten Eingangssignale als Zeitverläufe dargestellt. Der rechten Teil zeigt die dazugehörigen Ausgangssignale des Multiplizierers.

\begin{figure} [H]
    \centering
    \includegraphics[width=1\linewidth]{../Bilder/ac_multi_pd.png}
    \caption{Singalverhalten bei unterschiedlichen Phasenverschiebungen zwischen den Eingangssignalen $X_1$ und $Y_1$}
    \label{fig:ac_multi_pd}
\end{figure}

Wie erwartet besitzt das Signal mit der Phasenverschiebung von \SI{90}{\degree} nach der Multiplikation einen Mittelwert von \SI{0}{\volt}. Das unverschobene Signal besitzt einen Offset von etwa \SI{0.2}{\volt}, während das um \SI{180}{\degree} verschobene Signal einen Offset von \SI{-0.2}{\volt} zeigt. Bei allen drei Signalen enthält das Ausgangssignal einen hochfrequenten Anteil mit der doppelten Frequenz des Eingangssignals.\par
\medskip

Laut Datenblatt des MPY634 ergibt sich eine Phasendetektorschaltung, wenn am Ausgang des Multiplizierers ein einfacher RC-Tiefpass nachgeschaltet wird. In anderen Aufbauten wird am Multipliziererausgang ein Tiefpass mit anschließendem OP in Komaparatorschaltung verwendet.(\textbf{bewirkt das das gleiche? LAUT VID JA  => simulation!})
\medskip

Der Schaltungsaufbau im ALSK-Manual sieht hingegen vor, dass am Ausgang des Multiplizierers ein Integrator nachgeschaltet wird, der die PLL-Funktion vervollständigt. Dieser verhält sich ebenfalls wie ein Tiefpass. So entstehen aus den in Abbildung \ref{fig:ac_multi_pd} sichtbaren Signalen nach der Integration die in Abbildung \ref{fig:pd_op_out} dargestellten Signalverläufe.

\begin{figure} [H]
    \centering
    \includegraphics[width=1\linewidth]{../Bilder/pd_op_out.png}
    \caption{Singalverhalten bei unterschiedlicher Verschaltung des Integrators}
    \label{fig:pd_op_out}
\end{figure}

Die Abbildung \ref{fig:pd_op_out} zeigt den zeitlichen Verlauf des Integratorausgangs für die verschiedenen Phasenverschiebungen. Zu beachten ist hierbei, dass die Phasenlage der Eingangssignale unter realen Bedinungen nicht über längere Zeit auf den Maximalwerten $\phi = \SI{0}{\degree}$ bzw. $\phi = \SI{180}{\degree}$  bleibt, sondern sich dynamisch verändert. Für $\phi = \SI{90}{\degree}$ wird die Amplitude der hochfrequenten Komponente nach der Integration deutlich gedämpft, dennoch bleibt eine Restschwingung sichtbar. Die Mittelwertspannung bleibt in diesem Fall über die Zeit gleich, da die Summation der positiven und negativen Halbwellen des Eingangssignals zu 0 verläuft. Auffällig ist, dass dem Signal eine Gleichspannungskomponente von etwa \SI{2.511}{\volt} hinzugefügt wurde. Dies ist auf das Integrationsverhalten und die Verschaltung des Integrators zurückzuführen.\par
\medskip

Diese Gleichspannungskomponente kann auf verschiedene Sachen zurückgeführt werden. Beispielsweise enthält das Simmulationsmodell des TL082 Starbedingungen (Initial Bias), die an internen Transistorknoten VC und VE ein Potential von \SI{2.2}{\volt} als Startwert definiert. So könnte schon ein großer Teil dieses Offsets erklärt werden. Die restlichen \SI{0.3}{\volt} könnten von einer Standard-Eingangsoffsetspannung kommen. Diese wird sofort in der Integration berücksichtigt und führt zu einer Gleichspannung am Ausgang, obwohl rein mathematisch kein Offset vorhanden sein sollte. \textbf{Eine Simulation mit einem idealen OPV würde diese zusätzliche Verstärkung nicht zeigen.}
\medskip

Bei den Extremwerten der Phasenverschiebung $\phi = \SI{0}{\degree}$ und  $\phi = \SI{180}{\degree}$ zeigt sich ebenfalls eine Erhöhung des DC-Anteils und eine gedämpfte Amplitude der AC-Komponente. Da das Sinussignal für beide Fälle nicht mehr um \SI{0}{\volt} zentriert ist, summieren sich die Schwingungen beim integrieren immer weiter auf. Für  $\phi = \SI{0}{\degree}$ steigt das Ausgangssignal linear mit einer Steigung von \SI{0.2}{\volt} pro ms an, für $\phi = \SI{180}{\degree}$ fällt die Spannung mit gleicher negativer Steigung ab.\par
\medskip

Ausgehend davon, dass die AC-Komponente noch deutlich sichtbar ist, kann durch Reduzierung der Filter-Grenzfrequenz mittels Vorwiderstand die Amplitude weiter verringert werden. Dies führt, wie im rechten Bild zusehen, zu einer weiteren Reduktion der Restwelligkeit. Bei genauer Betrachtung ist jedoch zu erkennen, dass immernoch eine gewisse Restwelligkeit vorhanden ist. Außerdem fällt auf, dass die Steigung bei niedriger Grenzfrequenz des Filters deutlich geringer ausfällt als bei hoher Grenzfrequenz. Diese liegt mit \SI{0.04}{\volt\per\milli\second} genau um den Faktor 5 geringer als die vorherige Ausgangsspannung. \textbf{(R um 5 vergrößert, Steigung um 5 verkleinert, Was passiert mit der welligkeit des signals? auf irgendwas um 5?)} Damit bestimmt die Grenzfrequenz des Integrators maßgeblich die Genauigkeit (Sensitivität) des Phasendetektors mit. \textbf{Auf diesen Zusammenhang wird später in Kapitel Sensitivität noch einmal genauer eingegangen}\par
\medskip

Zusätzlich lässt sich beobachten, dass sich bei sinkender Grenzfrequenz des Tiefpassfilters auch die zuvor erwähnte Gleichspannungs-Komponente ändert. In den vorliegenden Messungen steigt dieser Wert leicht auf \SI{2,565}{\volt}. \textbf{Dieser Effekt ist so zu beschreiben. Der Spannungsabfall über den Vorwiderstand ist mit $V=I_{Bias} \cdot R$ zu beschreiben. Dabei ist der Eingangsbiasstrom vom OPV abhänig und immer gleich groß. Je größer also der Vorwiderstand R wird, desto größer ist der Spannungsabfall über diesen, was ebenfalls zu einem höheren Offset am ausgang führt. Zudem ist die Gesammtverstärkung des OPVs $\frac{1}{RC}$, wenn $R$ nun größer wird, wird der Offset größer??? }

\medskip
%https://www.ti.com/content/dam/videos/external-videos/zh-tw/1/3816841626001/4082104055001.mp4/subassets/opamps-offset-voltage-input-bias-specifications-presentation-quiz.pdf


\subsection{Simultation von Eingangssignalen unterschiedlicher Frequenz}
Ziel dieser Simulation ist, zu erkennen, wie die Steuerspannung $V_c$ auf unterschiedliche Phasendifferenzen am Eingang des Phasendetektors reagiert.\par
\medskip
Dafür werden zwei Signale ähnlicher Frequenz auf das System gegeben. Das Referenzsignal schwingt mit \SI{1000}{\hertz}, dazu kommt ein Eingangssignal mit %\SI{900}{\hertz} bzw.
\SI{1100}{\hertz}.\par
\medskip

\begin{figure} [H]
    \centering
    \includegraphics[width=1\linewidth]{../Bilder/versch_freq_4.png}
    \caption{Singalverhalten bei unterschiedlichen Eingangsfrequenzen}
    \label{fig:pd_out_freq}
\end{figure}

\medskip
Zu Beginn der Simulation liegt die Phasendrehung des \SI{1100}{\hertz}-Signals  zum Referenzsignal. Dadurch, dass das Eingangssignal schneller schwingt, verändert sich das Verhlätnis in kurzer Zeit (etwa \SI{2.5}{\milli\second}) auf \SI{+90}{\degree}. Das ist unter anderem auch daran zu erkennen, dass der Gleichspannungsanteil im Ausgangssignal des Multiplizierers zu \SI{0}{\volt} abfällt. Aus Abbildung \ref{fig:ac_multi_pd} ist bekannt, dass bei einer Gleichspannung von \SI{0}{\volt} die Phasenverschiebung \SI{\pm 90}{\degree} beträgt. Da in diesem Simualtionszenario noch keine Anpassung geschied, verschiebt sich der Phasenwinkel zwischen den Signalen weiter bis diese bei \SI{5}{\milli\second} mit \SI{180}{\degree} zu einander stehen. An diesem Punkt ist der maximale negative Gleichspannungsanteil erreicht. Im weiteren Verlauf bewegt sich das Ausgangssignal wieder auf eine \SI{0}{\degree} Phasendifferenz zu. \par
\medskip

Ähnlich verhält sich ein langsameres \SI{900}{\hertz}-Signal. Einziger großer Unterschied ist, dass das Eingangssignal dem Ausgangsssignal nicht voraus läuft, sondern hinterher. Die Phasenverschiebung ist demnach negativ. Das bewirkt auch, dass zwischen dem Kreislauf von \SI{0}{\degree}  zu \SI{0}{\degree} (Periode des Niederfrequenten signal) eine Periode des Höherfrequenten Signal weniger im vergleich zu zweifach multiplizierten Ref-Signals bzw. zwei perioden weniger als das \SI{1100}{\hertz}-Signal. Außerdem ist durch die negative Phasenverschiebung die richtung der Phasenverschiebung umgekehrt.(von 0 nach 270 nach 180 nach 90 nach 0) \par
\medskip
bei betrachtung von \ref{fig:pd_out_freq} fällt auf, dass sich die durchschnittliche Ausgangsspannung gegen den Phasenwinkel nocheinmal selbst bestimmen lässt. (Ref: abbildung 4,6) diese verläuft hier leicht sinusförmig, anstatt gerade.
\medskip



\begin{figure} [H]
    \centering
    \includegraphics[width=1\linewidth]{../Bilder/versch_freq_3.png}
    \caption{Abhängigkeit zwischen der Steuerspannung $V_c$ und der Phasendifferenz}
    \label{fig:op_out_freq}
\end{figure}
\textbf{x-achse noch in gradzahlen?}

Nach der Integration dieser Ausgangssignale zeigt sich eindeutig, dass $V_c$ zwischen der Phasenlage von \SI{90}{\degree} über \SI{180}{\degree} bis \SI{270}{\degree} vom Potential her steigt. (also um 180 Grad, 90 und 270 sind die Grenzwerte). Wenn sich die Phase des Eingangssignals aber zwischen \SI{270}{\degree} und \SI{90}{\degree} bewegt, sinkt die Spannung $V_c$. 

\section{Aufbau und Steuerung des Voltage Controlled Filters}

\textbf{Was ist ein VCF}


\subsection{Abbinder zu PLLs}
\textbf{weiß noch nicht wo das hinsoll}
Wie zuvor in Abbildung \ref{fig:bsb_pll} zusehen besteht der klassische PLL aus einem Phasendetektor, einem Loopfinter und einem VCO. Durch das Schaltbild in Abbildung \ref{fig:sb_phasedetector} zweigten sich die ersten zwei Teilmodule. Die Phasendifferenz wurde durch den analogen Multiplizierer detektiert und der anschließende Integtator filterte die hochfrequente Komponente heraus. Als nächstes würde der VCO folgen. In dieser Thesis wird allerdings kein VCO an die Konntrollspannung $V_c$ angeschlossen, sonder ein Voltage Controlled Filter (VCF). Also wird im Experiment 5 des ASLK-PRO Manuals kein klassischer PLL aufgebaut, sondern eine selbstabstimmende Filterstruktur, bei der die Mittenfrequenz des Filters dynamisch an die Frequenz des Eingangsnignals angepasst wird.\par
\medskip
Zusammengefasst ist der Unterschied, dass das Filterverhalten und nicht die Frequenz des Oszillators geregelt wird. Trotzdem sind die Rückkopplungslogik und die Mathematische Grundstruktur dem PLL sehr ähnlich. Die Schaltung basiert also auf PLL-Prinzipien, regelt aber einen VCF anstatt eines VCOs.\par
\medskip


\subsection{Voltage Controlled Filter}


Der Voltage Controlled Filter basiert auf dem Biquad aus vergangendem Semester. Neben dem im vergangenen Kapitel besprochenen Phasendetektor wurde die Biquad-Schaltung noch so verändert, dass sich die Grenzfrequenz über die Steuerspannung $V_c$ verändern lässt. Dazu wurde der Schaltplan um die Frequenzgebenden Integratoren verändert.

\begin{figure}[!h]
  \centering
  \resizebox{0.6\textwidth}{!}{\input{sb_vcintegrator.tex}}
  \caption{Teilschaltung: Spannungsgesteuerter Integrator}
  \label{fig:sb_vci}
\end{figure}

Wie schon in bei der Standard-Integratorschaltung wird auch für diese Schaltung die Übertragungsfunktion hergeleitet. Da der Strom durch den Widerstand vollständig durch den Kondensator in der Rückführungsschleife fließen muss, ergibt sich folgender Zusammenhang:

\begin{equation}
I_R = \frac{V_{in}}{R} = -I_C = -C \cdot \frac{dV_{cap}}{dt}
\label{eq:integrator_current}
\end{equation}

Daraus folgt:

\begin{equation}
\frac{V_{in}}{R} = -C \cdot \frac{dV_{cap}}{dt}
\label{eq:integrator_relation}
\end{equation}

Mit $V_{cap} = \frac{V_{out} \cdot V_c}{V_r}$ ergibt sich:

\begin{equation}
\frac{V_{in}}{R} = -C \cdot \frac{d}{dt}\left(\frac{V_{out} \cdot V_c}{V_r}\right)
\end{equation}

Durch Integration erhält man den Zusammenhang im Zeitbereich:

\begin{equation}
V_{out}(t) = -\frac{V_r}{V_c} \cdot \frac{1}{RC} \int V_{in}(t) \, dt
\label{eq:integrator_time}
\end{equation}

Im Laplace-Bereich ergibt sich entsprechend:

\begin{equation}
V_{out}(s) = -\frac{V_r}{V_cRCs} \, V_{in}(s)
\label{eq:integrator_laplace}
\end{equation}

Somit zeigt die Schaltung das Verhalten eines invertierenden Integrators mit einem Verstärkungsfaktor von $-\frac{V_r}{V_cRC}$. Wegen des zusätzlichen Faktors $V_r/V_c$ mit der variablen Spannung $V_c$ wird ein Aufbau wie dieser auch Voltage Controlled Integrator (VCI) genannt.


was passiert bei hoher $V_c$ und was bei geringer? kann man den mulit als R oder spannungsquelle oder so auffassen?

Das ding alleine sollte alle Frequenzen gleich integrieren, da es parallel zum Kondensator keinen Widerstand hat. 


\subsection{Grenzfrequenzbestimmung des VCF}
Die Grenzfrequenz, auch Cutoff-Frequenz oder Mittenfrequenz genannt, ist einer der wichtigsten Parameter zur Bestimmung von Filtern. Sie zeigt an, wo sich im Spektrum der Übergangsbereich befindet, der den Durchlassbereich(Passband) von Sperrbereich(Stopband) trennt. So gibt dieser Parameter Auskunft darüber, welche Frequenzen verstärkt oder gedämpft werden, was die wichtigste Eingenschaft eines Filters ist.\par
\medskip
Aus der im letzten Abschnitt hergeleiteten Übertragungsfunktion im Laplace-Bereich \eqref{eq:integrator_laplace} kann nun über die systemtheoretische Betrachtung des Filters auf die Gesammtübertragungsfunktion geschlossen werden. Aus den Übertragungsfunktionen der einzelnen OpAmps lässt sich das in Abbildung \ref{fig:sb_sys_vcf} zusehende Blockschaltbild erschließen.


\begin{figure}[!h]
  \centering
  \resizebox{1\textwidth}{!}{\input{sb_sys_bsb_gesammt.tex}}
  \caption{Systemtheoretische Darstellung des VCF ohne Phasendetektor}
  \label{fig:sb_sys_vcf}
\end{figure}


Die daraus hervorgehende Übertragungsfunktion lautet

\begin{equation}
\frac{V_2}{V_{in}} = \frac{-H_0 sRC \frac{V_c}{V_r}}{\left(sRC\frac{V_c}{V_r}\right)^{2}+\frac{sRC}{Q}\frac{V_c}{V_r}+1}
\end{equation}

Die Übertragungsfunktion des einfachen Biquads in der Standardform lautet

\begin{equation*}
\frac{V_2}{V_i} = -\frac{\frac{s}{\omega_0}H_0}{1 + \frac{s}{\omega_0 Q} + \frac{s^2}{\omega_0^2}}
\end{equation*}

mit $\omega_0 = \frac{1}{RC}$

Um nun auf die Gleichung für die Grenzfrequenz zu kommen muss die Übertragungsfunktion so normiert werden, dass der Nenner dieser dem Nenner der Standardform entspricht. Bei Gleichsetzung der beiden höchsten Exponenten ergibt sich

\begin{equation*}
\left(\frac{s}{\omega_0}\right)^{2} = \left(sRC\frac{V_c}{V_r}\right)^{2}
\end{equation*}

Durch Herauskürzen von s, dem Exponenten und anschließender Termumformung nach $\omega_0$ ergibt sich 

\begin{equation}
\omega_0 = \frac{V_r}{V_cRC}
\end{equation}


\medskip
Im letzten Unterkapitel wurde die Beziehung zwischen der Phasendifferenz $\phi$ und der Steuerspannung $V_c$ ermittelt. Nun ist von Interesse, was diese Steuerpannung nun innerhalb des VCFs tut, bezeihungsweise was und wie die Phasendifferenz innerhalb des Systems steuert. \par
\medskip

Aus Abbildung \ref{fig:op_out_freq} ergibt sich, dass bei einer Phasenverschiebung um \SI{180}{\degree} bzw von \SI{90}{\degree} bist \SI{270}{\degree} die DC-Ausgangsspannung des Multiplizierers negativ ist und $V_c$ so nach der Integtration mit positivem Vorzeichen ansteigt. Durch die nun bestimmte Formel kann ein zusammenhang zwischen $V_c$ und der Grenzfrequenz des Filters $\omega_0$ hergestellt werden. 

Wenn der steigende Wert für $V_c$ nun in die Formel $\omega_0 = \frac{V_r}{V_cRC}$ eingesetzt wird, zeigt sich, dass bei größer werdenenm $V_c$ $\omega_0$ sinkt. Daraus kann geschlussfolgert werden, dass alle Phasenverschiebungen zwischen \SI{90}{\degree} und \SI{270}{\degree} zu einer Verringerung der Grenzfrequenz führen. 

Für Phasendifferenzen um \SI{0}{\degree} gilt dies genau umgekert: Das Potential von $V_c$ sinkt wodurch die Grenzfrequenz des Systems ansteigt.

\textbf{Erklärung wie genau die anpassung funktioniert, mit erklärender Abbildung. Dann auf pendelsystem eingehen}




\medskip
Beim erstellen dieser Abbildung ist aufgefallen, dass beide betrachteten Parameter um einen gewissen wert schwingen. Zum einen Schwingt die Phase um einen \SI{90}{\degree} bzw. \SI{270}{\degree} Phasenverzug zum Referenzsignal, zum anderen schwingt die Frequenz um die Referenzfrequenz. 

Die maximalen ausschlagswerte treten dabei meist ganz zu beginn der betrachtugn an, also wenn eine neue Grenzfrequenz eingestellt werden soll. Der maximale Ausschlagsimpuls (Fallhöhe) der Phase liegt bei \SI{0}{\degree} oder \SI{180}{\degree}








\medskip
\textbf{Berechnung der Grenzfrequenz aus dem Video}
Laut ASLK-PRO Manual müssten $V_c$ und $V_r$ getauscht sein. Jedoch ist die Grenzfrequenz eine physikalische Größe, die nicht von der Normierung abhängig sein darf. So kann davon ausgegangen werden, dass die im Manual vorgeschlagene Lösung entweder nicht korrekt ist, oder anders Normiert bzw eine andere Konvention verwendent wurde. (zweiteres ist unwahrscheinlicher, da der Rechenweg dadurch deutlich komplizierter zu sein scheint) YT vid  \cite{YT_stf_lab5}  sagt aber auch was anderes!!!\par
\medskip


\begin{figure}[!h]
  \centering
  \resizebox{0.8\textwidth}{!}{\input{sb_w0_herleitung.tex}}
  \caption{Vereinfachter Schaltplan zur Herleitung von $\omega_0$}
  \label{fig:bsb_w0}
\end{figure}

Laut Quelle (begleitendem YouTube Video zu diesem Experiment) \cite{YT_stf_lab5} kann die Formel für die Grenzfrequenz anhand dieser vereinfachten Schaltung abgeleitet werden. Die bekannte Formel für den Integrator lautet

\begin{equation}
V_{out} = -\frac{V_{i}}{sCR} \label{eq:integrator}
\end{equation}

Da $V_{i}$ gleich dem Ausgang des Multiplizierers ist ergibt sich für die Multiplizierergleichung

\begin{equation}
V_{i} = \frac{V_{in} \cdot V_c}{V_r} \label{eq:multiplizirer}
\end{equation}

Wird \eqref{eq:multiplizirer} nun in \eqref{eq:integrator} eingesetzt ergibt sich

\begin{equation*}
V_{out} = -\frac{\frac{V_{in} \cdot V_c}{V_r}}{sCR} = -\frac{V_{in} \cdot V_c}{V_r \cdot sRC}
\end{equation*}

Um die Übertragungsfunktion zu erlangen muss nun durch $V_{in}$ geteilt werden

\begin{equation*}
\frac{V_{out}}{V_{in}} = -\frac{V_c}{V_r \cdot sRC} = - \frac{V_c}{V_r} \cdot \frac{1}{sRC}
\end{equation*}

Aus dem Therm $\frac{1}{sRC}$ ergibt sich die Standartform $\omega_0 = \frac{1}{RC}$ mit einem zusätzlichen Faktor von $\frac{V_c}{V_r}$ sodass sich die Grenzfrequenz wiefolgt ergibt

\begin{equation}
\omega_0 = \frac{V_c}{V_r \cdot RC} \label{eq:freq-vcf}
\end{equation}

wobei
\begin{itemize}
  \item $\omega_0$ die Durchlassfrequenz des Filters ist,
  \item $V_c$ die Steuerspannung des VCFs ist,
  \item $V_r$ der Referenzwert des Multiplizierers ist (laut Datenblatt: $V_r=10V$),
  \item $RC$ die Zeitkonstante des Filters beschreibt.
\end{itemize}



\subsection{Ermittlung der Grenzfrequenz bei unbekannten Parametern}

Bei der Einstellung (Tuning) eines Filters ist das Ziel, möglichst Nahe an der Grenzfrequenz zuliegen. Für das Beispiel eines Bandpasses wird die Grenzfrequenz durch den Peak der Amplitude gekennzeichnet. Da sich die Amplitude an diesem Punkt nicht mit der Frequenz ändert, besitzt diese am Peak eine Steigung von Null.

Bild BP

Dies ist eine Möglichkeit die Grenzfrequenz zu ermitteln, wird nun jedoch bei einem Tiefpass die Grenzfrequenz gesucht funktioniert diese nicht mehr. Stattdessen liegt die Grenzfrequenz nun bei einem Wert von -3dB. Bei Veränderung der Güte auf einen wert von $Q = 5$ sieht man, dass keiner der Vorgestellten ansätzte zur Bestimmung der Grenzfrequenz funktioniert.


Bild TP Q=1 und 5, -3 db linie einzeichnen.


Eine alternative Methode zur Bestimmung der Grenzfrequenz führt über die Phase. Hierbei kann die im ersten Theorieteil herrgeleitete Übertragungsfunktion des Bandpasses als Anhaltspunkt genommen werden, um den Phasengang zu ermitteln. 

\begin{equation*}
\frac{V_2}{V_i} =  -\frac{ \frac{s}{\omega_0} H_0 }{ 1 + \frac{s}{\omega_0 Q} + \frac{s^2}{\omega_0^2} }
\end{equation*}

Im Allgemeinen zeigt der Zähler wo der Phasenverlauf startet, in diesem Fall beispielsweise bei $\phi(\omega=0)=-90^\circ$ durch den Nenner erhält man nun die Phasendrehung in abhänigkeit der Frequenz.\par
\medskip

sollte hier einmal $W=0, w=w_0 und w=unendlich $ ausgerechnet werden?\par

\medskip
Bild der Phase und Mag untereinander:
\medskip

In diesem Bild ist zu erkennen, dass die Phase stets die größte Steigung an der Grenzfrequenz hat. So kann die Grenzfrequenz durch Maximierung der Ableitung der Phase berechnet werden ohne das die Güte dieses Ergebnis manipulieren kann. Da die Güte auch die Steilheit der Flanken bestimmt ergibt sich zudem eine Abhänigkeit zwischen der Steigung und der Güte, diese sind nähmlich Propotional zu einander, je größer die Güte desto steiler der Übergang um die Mittenfrequenz. So kann festgehalten werden das zur bestimmung der Grenzfrequenz statt eines Magnitude Detektors besser ein Phasedetektor verwendet wird. So sollte man immer die Phase ansehen und nicht die magnitude, da die Phase an der Grenzfrequenz immer am steilsten ist, während nicht immer gewährleistet werden kann, dass die Magnitude dort am höchsten oder -3dB erreicht, da der Gütefaktor dies verzerrt. 

\textbf{was bringt mir das jetzt? verknüpfung zu meinem thema}


\section{Einfluss des VCF auf die Filterfrequenz und praktische Parametersteuerung}

\section{Sensitivitätsanalyse von Filter und Detektor}

Was zeigt die Sensitivität im allgemeinen

\subsection{Sensitivität des Phasendetektors}

Die Sensitivität des Phasendetektors $K_{pd}$ kann durch folgende Geichung beschrieben werden:

\begin{equation*}
K_{pd} = \frac{dV_{av}}{d \phi} \left[ \frac{V}{rad}\right]
\end{equation*}

Wobei $V_{av}$ den duchschnittlichen Spannungswert des Ausgangs $V_o$? beschreibt.
Die Ableitung des Ausgangssignals im Duchschnitt nach der Phasendifferenz gibt an, wie stark sich die Ausgangsspannung bei Änderung der Phasendifferenz verändert. Für $\phi = 90^\circ$ hat $V_{av}$ einen Wert von 0 Volt.\par
\medskip


\textbf{Kann man hier noch irgendwas rechnen? z.B. für eine Bestimmte frequenz? oder ist das immer 20V/pi wie in der Abbildung weiter oben?}
was sagt die sensitivität in diesem Fall aus? kann dazu noch etwas gemessen/ simuliert werden?

\subsection{Sensitivität des VCFs}
Bei Ableitung der Gleichung für die Grenzfrequenz \eqref{eq:freq-vcf}  nach der Steuerspannung $V_c$ ist zu erkennen, wei empfindlich die Filterfrequenz auf die anliegende Steuerspannung reagiert.

\begin{equation*}
\frac{d \omega_0}{d V_c} = \frac{1}{V_r \cdot RC}
\end{equation*}

Durch einfaches Umstellen der selben Gleichung \eqref{eq:freq-vcf} ergibt sich

\begin{equation*}
\frac{\omega_0}{V_c} = \frac{1}{V_r \cdot RC}
\end{equation*}

So ergibt sich ein Gesammtzusammenhang, der die Empindlichkeit der Filterfrequenz gegenüber der Änderung der Steuerspannung beschreibt.

\begin{equation}
\frac{d \omega_0}{d V_c} =  \frac{\omega_0}{V_c} \label{eq:empf_w0-Vc}
\end{equation}

Die Größen der Grenzfrequenz und der Steuerspannung verhalten sich direkt Proportional zu einander. So entspricht die relative Änderung der Frequenz der relativen Änderung der Steuerspannung. Mit anderen Worten: Verdoppelt sich die Steuerspannung verdoppelt sich auch die Grenzfrequenz. (bei linearer Abhänigkeit)\par
\medskip


Die Sensitivität des gesammten VCFs lässt sich durch folgende Gleichung beschreiben

\begin{equation}
\frac{d \phi}{d V_c} = \frac{d \phi}{d \omega_0} \cdot \frac{d \omega_0}{d V_c} \label{eq:ges-sensitivität}
\end{equation}

Hierbei zeigt diese Gleichung, wie stark die Phasendifferenz auf eine Änderung der Steuerspannung reagiert (unter berücksichtigung der Sensitivität des Filters und des Phasendetektors).

Der hintere Teil der Gleichung wird in \eqref{eq:empf_w0-Vc} beschrieben. Nun muss nur noch $\frac{d\phi}{d\omega}$ ermittelt werden.
\medskip

Dafür kann eine Übertragungsfunktion des Filters verwendet werden. Hierbei bietet sich die Tiefpass-Übertragungsfunktion an, da diese einen Phasengang zeigt, der seinen Startwert bei $0^\circ$ hat. 

\begin{align}
H(s)&=\frac{V_{o_{TP}}}{V_i} = \frac{H_0}{1 + \frac{s}{\omega_0 Q} + \frac{s^2}{\omega_0^2}} \label{eq:u_tp} \\
H(s)&= H(j \omega_r) = \frac{H_0}{1 + \frac{j \omega_r}{\omega_0 Q} + \frac{(j \omega_r)^2}{\omega_0^2}} = \frac{H_0}{1 - \frac{ \omega_r^2}{\omega_0^2} + j\frac{\omega_r}{\omega_0 Q} } \nonumber
\end{align}

Der Phasenwinkel einer Übertragungsfunktion wird berechnet, indem Zähler und Nenner jeweils als komplexe Zahlen betrachtet werden und für beide die Argumente ermittelt werden, also der Winkel ihrer komplexen Werte im Frequenzbereich. Der Phasenwinkel der gesuchten Übertragungsfunktion ergibt sich durch

\begin{equation}
\phi = arg(Z"ahler)-arg(Nenner)
\end{equation}

wobei $\arg(z)$ der Winkel der komplexen Zahl $z$ ist. Für diese Übertragungsfunktion ergibt sich also ein $\phi$ von

\begin{equation}
\phi = -tan^{-1} \left(\frac{\frac{\omega_r}{\omega_0 Q}}{1- (\frac{\omega_r}{\omega_0}) ^2}\right)
\end{equation}

Da der Zähler der Übertragungsfunktion $0^\circ$ hat fällt dieser aus der Rechnung heraus. 

\textbf{Hinweis}: im Manual steht im Nenner der tan funktion nur ein $\omega_0$ ohne quadrat! Zudem fehlt das - Zeichen.
\medskip

$\omega_r$ ist die Eingangskreisfrequenz. Die gesammte Formel beschreibt die Phasenverschiebung des Filters zum Eingangssignal.






\medskip
An dieser Stelle könnte nun eine Lange rechnung stehen wie man zu diesem Ergebniss kommt. Hier die Kurzfassung

\begin{equation}
\frac{d \phi}{d \omega_0}= -\frac{2Q}{\omega_0}
\end{equation}


Eingesetzt in die Gleichung \eqref{eq:ges-sensitivität} ergibt sich daraus die Sensitivität:

\begin{equation}
\frac{d \phi}{d V_c} = \frac{d \phi}{d \omega_0} \cdot \frac{d \omega_0}{d V_c} = - \frac{2Q}{\omega_0} \cdot \frac{\omega_0}{V_c}=-\frac{2Q}{V_c}
\end{equation}


\textbf{schreiben was das genau besagt, damit man das vielleicht später in einer messung validieren kann}



\section{Theoretische Bestimmung über welche Bandbreite der Filter selfe-tuned bleibt, ohne die physischen Bauelemente zu verändern}

\subsection{Bestimmung der Maximalen Grenzfrequenz eines aktiven Filters}

Wie zuvor schon besprochen lässt sich die bauteilbedingte Grenzfrequenz eines aktiven Filters über die Formel $\omega_0 = \frac{1}{RC}$ beschreiben. Bei Veränderung der verwendeten Bauteilwerte der Elemente $R$ und $C$ lässt sich die Grenzfrequenz in der Theorie beliebig verändern. In der Praxis können bei sehr kleinen Werten parasitäre Effekte das Filterverhalten stark beeinflussen. Besonders wenn diese Elemente nur "Standart"-Bauteile sind. \par
\medskip
Auch die Wahl des verwendeten OpAmps spielt beim erreichen der maximal Möglchen Grenzfrequenz eine wichtige Rolle. So sind vor allem die Parameter für das Gain-Bandwidth-Product (GBW) und die Slew-Rate (SR) entscheidend. Das GBW gibt an, bis zu welcher Frequenz der OpAmp den gewünscheten Filterverlauf mit einer Verstärkung von 1 liefern kann. Die Slew-RAte beschreibt die maximale Anstiegsrate der Ausgangsspannung des OpAmps. \par
\medskip
Zu guter letzt spielen topologieabhänigen Limitationen eine Rolle. So können höhere Filterordnungen sowie das allgemeine Schaltungsdesign die Maximalgrenze ebenfalls verschieben. (Bei höheren Ordnungen beansprucht jede Filerstufe einen Teil der Verstärkungsbandbreite für sich)\par
\medskip
\textbf{hier noch ein paar worte dazu wie das nun in der Wirklichkeit gehandhabt wird} In der Realität wird geschaut, wie hoch die maximal zu erreichende Grenzfrequnz sein wird. Anhand dessen wird der Operationsverstärker herausgesucht, haupstäachlich anhand der parameter GBW und SR. Meist wird ein GBW genommen das 10 oder 100x häher ist als die maximal anzudenhmende grenzfrequenz. Daran angepasst werden schließlich die restlichen Bauteilwerte des Filters ausgewählt, sodass die gewünschte Grenzfrequenz erreicht wird.\par
\medskip


Quellen:
%https://www.youtube.com/watch?v=N8UhfnbKX6Q&t=2341s
%https://ww1.microchip.com/downloads/en/DeviceDoc/adn003.pdf
%https://dk.farnell.com/enhancing-signal-quality-understanding-the-role-of-filters-trc-ar
(Farnell beschreibt auch unterschied aktiv und passiv filter)

\subsection{Bestimmung des maximalen Tune-Bereich des hier verwendeten Filter}

Eine weitere Interessante Frage ist, über welchen Bereich die Mittenfrequenz des Filters über die selfe-Tune Funktion verstellt werdenkann, ohne die Größe der verwendeten Bauelemente zu verändern. (Zudem ist wichtig herauszufinden wie ich das Messen kann)\par
\medskip

Hierfür Quellen zu finden ist noch schwieriger als eh schon für das Thema. In der Theorie hat sich noch niemand so richtig damit beschäftigt, jedenfalls finde ich dazu nichts. Um herauszufinden wie groß der Tune-Bereich um die Bauteilbedingte Mittenfrequenz ist, sollte also eine Simulation oder direkt eine Messung gemacht werden. (Sim schwierig, da ich teile der Bauteilsims selber schreiben muss, da wieß ich nicht worauf ich achten soll.)




%https://www.digitalxplore.org/up_proc/pdf/143-143133720956-59.pdf









\section{Frequenzdetektion des Eingangssignals}

Wie im oberen Teil beschrieben kann ein Selfe-Tuned Filter genau auf die Frequenz des empfangende Signals peilen. Aus diesem Grund dachte ich mir das eine Frequenzbestimmung über dden Microcontroller eine sinnvolle Sache wäre, um festzustellen (ohne Bode-Plot und RedPitaya) auf welche Frequenz der Filter gerade eigestellt ist.\par
\medskip

Die Umsetzung der Frequenzmessung lässt sich analog oder digital beschreiben. Als analoge Option könnte ein Frequenz-Spannungs-Wandler (F/V-Converter) verwendet werden, der die Frequenz des Eingangssingals in eine proportionale Gleichspannung umwandelt. Diese kann im anschluss über einen ADC am µC ausgelesen werden. Der große Vorteil hierbei ist, das die Reaktion der Detektion sehr schnell ist, Nachteilig ist, dass das eingangssignal noch Vorverarbeitet werden muss um einem Rechteksignal zu entsprechen. Zudem ist der Dynamikbereich begrenzt , da sehr hohe oder nidirge Frequenzen spetzielle anpassungen erfordern. Für eine Umsetzung dieses Verfahrens bräuchte man also viele Externe Komponenten, die einmal installiert zu einschränkungen in der Flexibilität führen, da diese nicht mehr so leicht verändert werden können.\par
\medskip

Im Vergleich dazu spricht für den digitalen ansatz, dass deutlich weniger exterene Bauteile von nöten sind und durch die Programmierung des Zählers eine größerer Flexibilität geboten wird. So kann die Frequenz beispielsweise mit einem Nulldurchgangszähler ermittelt werden. Dieser Zählt wie der Name schon sagt, die Anzahl der Nulldurchgänge oder Pulse Pro Sekunde, teilt diese Zahl durch 2, sodass als ergebnis die Frequenz in Hz herauskommt. Der begrenzende Faktor bei dieser Umsetzung ist das die MEssfrequnez auf die Zeitbasis des µc limitiert ist. Da der µC Rechteck- bzw Tacktsignale erwartet, müüssen analoge Signale wie Sinus, Dreieck und Sägezahn auch hier vorverarbeitet werden. So kann ein Komparator diese Signale effektiv in saubere Rechteckimpulse umwandeln, sodass auch bei kleineren Pegeln sauber gearbeitet werden kann. Zudem schadet auch hier keine Vorverarbeitung, sodass mit einer Rechteckspannung gerechnet werden kann.\par
\medskip

Num bleibt nur noch das Problem, dass immernoch keine Mischsignale aus mehreren Frequenzen erkannt werden können. Für diesen Fall gibt es die FFT ... 

Brauche ich das Überhaupt? kommen überhaupt mischsignale auf mein system drauf? Wie verhält sich das system wenn mischsignale auf dieses gebracht werden?










\end{document}
